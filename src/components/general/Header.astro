---
const pathname = Astro.url?.pathname ?? "/";
const isTR = pathname.startsWith("/tr");

// Sprachwechsel-URLs (gleicher Pfad mit/ohne /tr)
const dePath = isTR ? pathname.replace(/^\/tr(?=\/|$)/, "") || "/" : pathname;
const trPath = isTR ? pathname : `/tr${pathname === "/" ? "" : pathname}`;

let deHref = dePath;
let trHref = trPath;

// Sonderfall: Legal nur DE
const legalDE = new Set(["/impressum", "/datenschutz"]);
if (!isTR && legalDE.has(dePath)) trHref = "/tr/";

const legalTR = new Set(["/tr/impressum", "/tr/datenschutz"]);
if (isTR && legalTR.has(pathname)) {
  deHref = pathname.replace(/^\/tr/, "") || "/";
  trHref = "/tr/";
}

// Nav-Items
const navItemsDE = [
  { href: "/", label: "Start" },
  { href: "/leistungen", label: "Leistungen" },
  { href: "/ueber-mich", label: "Ãœber mich" },
  { href: "/kontakt", label: "Kontakt" },
];

const navItemsTR = [
  { href: "/tr/", label: "Ana Sayfa" },
  { href: "/tr/leistungen", label: "Hizmetler" },
  { href: "/tr/ueber-mich", label: "HakkÄ±mda" },
  { href: "/tr/kontakt", label: "Ä°letiÅŸim" },
];

const navItems = isTR ? navItemsTR : navItemsDE;

// Brand
const brandHref = isTR ? "/tr/" : "/";
const brandSubtitleFull = isTR ? "Almanca â†” TÃ¼rkÃ§e Dil AracÄ±lÄ±ÄŸÄ±" : "Sprachmittlung Deutsch â†” TÃ¼rkisch";
const brandSubtitleShort = isTR ? "Dil AracÄ±lÄ±ÄŸÄ±" : "Sprachmittlung";

// Active Link Helper (nimmt /tr/ sauber mit)
const normalize = (p: string) => (p.endsWith("/") && p !== "/" ? p.slice(0, -1) : p);
const current = normalize(pathname);
const isActive = (href: string) => normalize(href) === current;
---

<header class="site-header">
  <div class="container header-inner">
    <a href={brandHref} class="brand" aria-label={isTR ? "Ana sayfa" : "Startseite"}>
      <img
        src="/logo.png"
        alt="Zehra Yacine â€“ Sprachmittlung Deutsch â†” TÃ¼rkisch"
        class="logo-image"
        loading="eager"
        decoding="async"
      />
      <span class="brand-title">
        Zehra Yacine
        <span class="brand-subtitle brand-subtitle--full">{brandSubtitleFull}</span>
        <span class="brand-subtitle brand-subtitle--short">{brandSubtitleShort}</span>
      </span>
    </a>

    {/* Desktop Row: Nav + Language */}
    <div class="right desktop">
      <nav class="main-navigation" aria-label={isTR ? "Ana navigasyon" : "Hauptnavigation"}>
        <ul class="nav-links">
          {navItems.map((item) => (
            <li>
              <a
                href={item.href}
                class:list={["nav-link", isActive(item.href) && "is-active"]}
                aria-current={isActive(item.href) ? "page" : undefined}
              >
                {item.label}
              </a>
            </li>
          ))}
        </ul>
      </nav>

      <div class="lang-links" aria-label={isTR ? "Dil seÃ§imi" : "Sprache wÃ¤hlen"}>
        <a
          href={deHref}
          lang="de"
          hreflang="de"
          aria-label="Deutsch"
          aria-current={!isTR ? "page" : undefined}
          class:list={["lang-link", !isTR ? "is-active" : "is-inactive"]}
        >
          <span class="flag" aria-hidden="true">ðŸ‡©ðŸ‡ª</span>
          <span class="code">DE</span>
        </a>

        <span class="lang-sep" aria-hidden="true">â€¢</span>

        <a
          href={trHref}
          lang="tr"
          hreflang="tr"
          aria-label="TÃ¼rkÃ§e"
          aria-current={isTR ? "page" : undefined}
          class:list={["lang-link", isTR ? "is-active" : "is-inactive"]}
        >
          <span class="flag" aria-hidden="true">ðŸ‡¹ðŸ‡·</span>
          <span class="code">TR</span>
        </a>
      </div>
    </div>

    {/* Mobile Row: Language + Menu */}
    <div class="right mobile" aria-label={isTR ? "MenÃ¼ ve dil" : "MenÃ¼ und Sprache"}>
      <div class="lang-links" aria-label={isTR ? "Dil seÃ§imi" : "Sprache wÃ¤hlen"}>
        <a
          href={deHref}
          lang="de"
          hreflang="de"
          aria-label="Deutsch"
          aria-current={!isTR ? "page" : undefined}
          class:list={["lang-link", !isTR ? "is-active" : "is-inactive"]}
        >
          <span class="flag" aria-hidden="true">ðŸ‡©ðŸ‡ª</span>
          <span class="code">DE</span>
        </a>

        <span class="lang-sep" aria-hidden="true">â€¢</span>

        <a
          href={trHref}
          lang="tr"
          hreflang="tr"
          aria-label="TÃ¼rkÃ§e"
          aria-current={isTR ? "page" : undefined}
          class:list={["lang-link", isTR ? "is-active" : "is-inactive"]}
        >
          <span class="flag" aria-hidden="true">ðŸ‡¹ðŸ‡·</span>
          <span class="code">TR</span>
        </a>
      </div>

      <details class="mobile-menu">
        <summary class="burger" aria-label={isTR ? "MenÃ¼yÃ¼ aÃ§/kapat" : "MenÃ¼ Ã¶ffnen/schlieÃŸen"}>
          <span class="burger-lines" aria-hidden="true"></span>
        </summary>

        <nav class="mobile-nav" aria-label={isTR ? "Mobil menÃ¼" : "Mobiles MenÃ¼"}>
          <ul class="mobile-links">
            {navItems.map((item) => (
              <li>
                <a
                  href={item.href}
                  class:list={["mobile-link", isActive(item.href) && "is-active"]}
                  aria-current={isActive(item.href) ? "page" : undefined}
                >
                  {item.label}
                </a>
              </li>
            ))}
          </ul>
        </nav>
      </details>
    </div>
  </div>
</header>

<style>
  /* Layout / Performance */
  .site-header {
    position: sticky;
    top: 0;
    z-index: 60;
    contain: layout paint style; /* scroll perf */
    content-visibility: auto;
    background: rgba(255, 255, 255, 0.72);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(15, 23, 42, 0.08);
  }

  .container {
    width: min(1120px, 92vw);
    margin: 0 auto;
  }

  .header-inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 14px;
    padding: 12px 0;
  }

  /* Brand */
  .brand {
    display: inline-flex;
    align-items: center;
    gap: 12px;
    text-decoration: none;
    color: rgba(15, 23, 42, 0.92);
    min-width: 0;
  }

  .logo-image {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    box-shadow:
      0 10px 20px rgba(15, 23, 42, 0.10),
      0 2px 8px rgba(15, 23, 42, 0.06);
  }

  .brand-title {
    display: inline-flex;
    flex-direction: column;
    gap: 2px;
    font-weight: 800;
    letter-spacing: -0.01em;
    line-height: 1.1;
    white-space: nowrap;
  }

  .brand-subtitle {
    font-weight: 600;
    letter-spacing: 0;
    color: rgba(15, 23, 42, 0.62);
    font-size: 12px;
  }

  .brand-subtitle--short { display: none; }

  /* Right blocks */
  .right {
    display: flex;
    align-items: center;
    gap: 14px;
  }

  .desktop { display: none; }
  .mobile { display: flex; }

  /* Nav */
  .nav-links {
    display: flex;
    gap: 6px;
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .nav-link {
    display: inline-flex;
    align-items: center;
    padding: 10px 12px;
    border-radius: 12px;
    text-decoration: none;
    font-weight: 650;
    font-size: 14px;
    color: rgba(15, 23, 42, 0.78);
    border: 1px solid transparent;
    transition: background-color 160ms ease, border-color 160ms ease, transform 160ms ease;
  }

  .nav-link:hover {
    background: rgba(15, 23, 42, 0.04);
    border-color: rgba(15, 23, 42, 0.08);
    transform: translateY(-1px);
  }

  .nav-link.is-active {
    background: rgba(197, 138, 43, 0.12);
    border-color: rgba(197, 138, 43, 0.22);
    color: rgba(15, 23, 42, 0.90);
  }

  /* Language Switch */
  .lang-links {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 8px 10px;
    border-radius: 999px;
    border: 1px solid rgba(15, 23, 42, 0.10);
    background: rgba(255, 255, 255, 0.70);
    box-shadow:
      0 10px 20px rgba(15, 23, 42, 0.10),
      0 2px 8px rgba(15, 23, 42, 0.06);
  }

  .lang-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
    font-weight: 750;
    font-size: 13px;
    color: rgba(15, 23, 42, 0.78);
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid transparent;
    transition: background-color 160ms ease, border-color 160ms ease, transform 160ms ease;
  }

  .lang-link:hover {
    transform: translateY(-1px);
    background: rgba(15, 23, 42, 0.04);
    border-color: rgba(15, 23, 42, 0.08);
  }

  .lang-link.is-active {
    background: rgba(197, 138, 43, 0.14);
    border-color: rgba(197, 138, 43, 0.24);
    color: rgba(15, 23, 42, 0.92);
  }

  .lang-sep {
    color: rgba(15, 23, 42, 0.35);
    font-size: 12px;
  }

  .flag { font-size: 14px; line-height: 1; }
  .code { letter-spacing: 0.04em; }

  /* Mobile menu (details/summary) */
  .mobile-menu {
    position: relative;
  }

  summary { list-style: none; }
  summary::-webkit-details-marker { display: none; }

  .burger {
    display: inline-grid;
    place-items: center;
    width: 44px;
    height: 44px;
    border-radius: 14px;
    border: 1px solid rgba(15, 23, 42, 0.10);
    background: rgba(255, 255, 255, 0.70);
    box-shadow:
      0 10px 20px rgba(15, 23, 42, 0.10),
      0 2px 8px rgba(15, 23, 42, 0.06);
    cursor: pointer;
  }

  .burger-lines {
    width: 18px;
    height: 2px;
    background: rgba(15, 23, 42, 0.72);
    border-radius: 999px;
    position: relative;
  }

  .burger-lines::before,
  .burger-lines::after {
    content: "";
    position: absolute;
    left: 0;
    width: 18px;
    height: 2px;
    background: rgba(15, 23, 42, 0.72);
    border-radius: 999px;
  }

  .burger-lines::before { top: -6px; }
  .burger-lines::after  { top:  6px; }

  .mobile-nav {
    position: absolute;
    right: 0;
    top: calc(100% + 10px);
    width: min(320px, 88vw);
    border-radius: 18px;
    padding: 10px;
    border: 1px solid rgba(15, 23, 42, 0.10);
    background: rgba(255, 255, 255, 0.92);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    box-shadow:
      0 20px 46px rgba(15, 23, 42, 0.18),
      0 8px 18px rgba(15, 23, 42, 0.12);
  }

  .mobile-links {
    list-style: none;
    padding: 0;
    margin: 0;
    display: grid;
    gap: 6px;
  }

  .mobile-link {
    display: flex;
    padding: 12px 12px;
    border-radius: 14px;
    text-decoration: none;
    font-weight: 700;
    color: rgba(15, 23, 42, 0.86);
    border: 1px solid transparent;
    background: rgba(15, 23, 42, 0.02);
    transition: transform 160ms ease, background-color 160ms ease, border-color 160ms ease;
  }

  .mobile-link:hover {
    transform: translateY(-1px);
    background: rgba(15, 23, 42, 0.04);
    border-color: rgba(15, 23, 42, 0.08);
  }

  .mobile-link.is-active {
    background: rgba(197, 138, 43, 0.14);
    border-color: rgba(197, 138, 43, 0.24);
  }

  /* Responsive */
  @media (min-width: 920px) {
    .desktop { display: flex; }
    .mobile { display: none; }
  }

  @media (max-width: 520px) {
    .brand-subtitle--full { display: none; }
    .brand-subtitle--short { display: inline; }
  }

  @media (prefers-reduced-motion: reduce) {
    .nav-link,
    .lang-link,
    .mobile-link {
      transition: none;
    }
    .nav-link:hover,
    .lang-link:hover,
    .mobile-link:hover {
      transform: none;
    }
  }
</style>