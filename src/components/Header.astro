---
const pathname = Astro.url?.pathname ?? "/";
const isTR = pathname.startsWith("/tr");

// ---
// Sprachwechsel-URLs berechnen (Standard: gleicher Pfad mit/ohne /tr)
// ---
const dePath = isTR ? pathname.replace(/^\/tr(?=\/|$)/, "") || "/" : pathname;
const trPath = isTR ? pathname : `/tr${pathname === "/" ? "" : pathname}`;

let deHref = dePath; // z.B. /leistungen
let trHref = trPath; // z.B. /tr/leistungen

// ---
// Sonderfall: Impressum/Datenschutz gibt es nur auf Deutsch.
// Daher darf TR niemals auf /tr/impressum oder /tr/datenschutz zeigen.
// ---
const legalDE = new Set(["/impressum", "/datenschutz"]);

// Wenn wir auf DE-legal sind und TR gewÃ¤hlt wird -> auf TR-Startseite umleiten (kein 404)
if (!isTR && legalDE.has(dePath)) {
  trHref = "/tr/";
}

// Wenn jemand doch auf /tr/impressum oder /tr/datenschutz landet (z.B. alte Links),
// dann soll DE zurÃ¼ck auf die deutschen Legal-Seiten zeigen.
const legalTR = new Set(["/tr/impressum", "/tr/datenschutz"]);
if (isTR && legalTR.has(pathname)) {
  deHref = pathname.replace(/^\/tr/, "") || "/";
  trHref = "/tr/"; // sicherheitshalber
}

// ---
// Navigation: je nach Sprache Labels + Links (DE/TR Seiten)
// ---
const navItemsDE = [
  { href: "/", label: "Start" },
  { href: "/leistungen", label: "Leistungen" },
  { href: "/ueber-mich", label: "Ãœber mich" },
  { href: "/kontakt", label: "Kontakt" },
];

const navItemsTR = [
  { href: "/tr/", label: "Ana Sayfa" },
  { href: "/tr/leistungen", label: "Hizmetler" },
  { href: "/tr/ueber-mich", label: "HakkÄ±mda" },
  { href: "/tr/kontakt", label: "Ä°letiÅŸim" },
];

const navItems = isTR ? navItemsTR : navItemsDE;

// Brand-Link je nach Sprache
const brandHref = isTR ? "/tr/" : "/";

// Subtitle je nach Sprache (NEU)
const brandSubtitle = isTR
  ? "Almanca â†” TÃ¼rkÃ§e Dil AracÄ±lÄ±ÄŸÄ±"
  : "Sprachmittlung Deutsch â†” TÃ¼rkisch";
---

<header class="site-header">
  <div class="container header-inner">
    <a href={brandHref} class="brand" aria-label={isTR ? "Ana sayfa" : "Startseite"}>
      <img
        src="/logo.png"
        alt="Zehra Yacine â€“ Sprachmittlung Deutsch â†” TÃ¼rkisch"
        class="logo-image"
      />
      <span class="brand-title">
        Zehra Yacine
        <span class="brand-subtitle">{brandSubtitle}</span>
      </span>
    </a>

    <nav class="main-navigation" aria-label={isTR ? "Ana navigasyon" : "Hauptnavigation"}>
      <ul>
        {navItems.map((item) => (
          <li>
            <a href={item.href}>{item.label}</a>
          </li>
        ))}

        {/* Sprachwahl: bleibt auf gleicher Seite, auÃŸer bei Impressum/Datenschutz -> TR geht auf /tr/ */}
        <li class="lang-links" aria-label={isTR ? "Dil seÃ§imi" : "Sprache wÃ¤hlen"}>
          <a
            class={`lang-link ${!isTR ? "is-active" : "is-inactive"}`}
            href={deHref}
            lang="de"
            hreflang="de"
            aria-current={!isTR ? "page" : undefined}
            aria-label="Deutsch"
          >
            <span aria-hidden="true">ðŸ‡©ðŸ‡ª</span> <span class="code">DE</span>
          </a>

          <span class="lang-sep" aria-hidden="true">|</span>

          <a
            class={`lang-link ${isTR ? "is-active" : "is-inactive"}`}
            href={trHref}
            lang="tr"
            hreflang="tr"
            aria-current={isTR ? "page" : undefined}
            aria-label="TÃ¼rkÃ§e"
          >
            <span aria-hidden="true">ðŸ‡¹ðŸ‡·</span> <span class="code">TR</span>
          </a>
        </li>
      </ul>
    </nav>
  </div>
</header>